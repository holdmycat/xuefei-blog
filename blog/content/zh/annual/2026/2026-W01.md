---
title: "2026 年第 01 周 - 战斗闭环与核心玩法验证"
date: 2026-01-07
week: "2026-W01"
tags: ["Unity", "SLG", "Combat"]
draft: true
---

## 本周进展

### 2026-01-04（周日）

- ✅ **Deep Clone 性能优化**：废弃 BSON 序列化深拷贝，实现 `NPDataCloneUtility` + `Clone()` 手写克隆，解决锁竞争并大幅降低 GC。
- ✅ **黑板数据修复**：查明并修复 `ANP_BBValue` 缺失 `[Serializable]` 导致的数据丢失问题。
- ✅ **工具链建设**：开发 `ActionNodeGeneratorWindow`，实现 Action/Node 脚本自动化生成。
- ✅ **编辑器优化**：实现 Graph 资产在独立窗口打开，优化多屏工作流。
- 📅 **明日计划**:
  1. **栈动画状态机**: 为 UnitClassType 划分栈动画状态，并实现与行为树的联动。
  2. **基础战斗闭环**: 跑通 Soldie 从出生 -> 待机 -> 发现敌人 -> 追击 的完整流程。

### 2026-01-03（周六）

- ✅ **行为树架构设计**：确定了“同构树 + 根节点分流 + 黑板同步”的最终架构，解决了双端逻辑与表现复用的难题。
- ✅ **Zenject 集成**：解决了 Zenject 6 `AsSingle` + `WithId` 的冲突问题，并实现了 NP 行为树的 DI 工厂模式。
- ✅ **双端时钟驱动**：实现了 `ServerClockDriver` 和 `ClientClockDriver`，将 NP `Clock` 接入 Zenject `FixedTick` 系统。
- ✅ **文档体系建设**：输出了包含架构图、问题背景与解决方案的三篇核心架构文档，并自动同步到技术博客。
- 📅 **明日计划**:
  1. **Attack Loop**: 索敌 (Distance Check) -> 攻击 (Timer/Cooldown)。
  2. **Damage Calculation**: Server 端计算伤害，同步 HP 变化。
  3. **Visual Feedback**: Client 端播放攻击动画与受击特效 (RPC)。

### 2026-01-02（周五）

- ✅ **阵型系统**：实现了基于配置的方阵（Phalanx）排列逻辑，支持 Commander 相对坐标计算。
- ✅ **实体渲染**：实现了 Soldier 模型的加载与 GPU Instancing 渲染准备（目前使用 Prefab 模式）。
- ✅ **编辑器可视化**：添加了 Spawn Point 和 Squad 边界的 Gizmos 绘制，便于调试。

### 2026-01-01（周四）

- ✅ **数值系统架构重构**：实现了基于修改器（Modifier）的属性系统，支持 `Base -> Modifier -> Final` 的自动计算与广播机制。
- ✅ **Squad UI 架构**：设计并实现了 `SquadInfoViewModel` 和 `SquadInfoWidget`，完成了指挥官与方阵 UI 的动态绑定。
- ✅ **数据持久化修复**：修复了 `ShowcaseContext` 在 UI 重载时的数据丢失问题（Register 时序优化）。
- ✅ **技术文档输出**：输出了数值系统架构设计文档，并建立了自动同步到博客的 Git 工作流。
- 📅 **明日计划**:
  1. **Spawn Position**: 添加 Commander 和 Squad 的出生点逻辑与 Editor Gizmos 可视化。
  2. **Formation**: 实现 Squad 阵型逻辑。
  3. **Rendering**: 加载并渲染 Soldier 实体。
  4. **Self-Check**: 检查并修复潜在问题。

### 2025-12-31（周三 - 预备日）

- ✅ **年度计划交接**：完成了 2025 年末的总结归档，制定了 2026 年第一周的开发计划。
- 📅 **明日计划**:
  - **Legion Decision**: 评估军团层级的必要性。
  - **Squad & UI Sync**: 完成 Squad 数据与 UI 的同步。
  - **Soldier Loading**: 实现 Squad 下 Soldier 的实体加载。
