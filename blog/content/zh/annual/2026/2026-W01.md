---
title: "2026 年第 01 周 - 双端行为树架构与战略护城河"
date: 2026-01-07
week: "2026-W01"
tags: ["Unity", "SLG", "Architecture", "BehaviorTree"]
---

## 本周总结

本周（2026-01-01 至 2026-01-07）完成了从“数值架构验证”到“行为树核心落地”的关键跨越：

### 核心成果

- ✅ **双端同构行为树**: 确立了 Server/Client 共享行为树 + DI 工厂 + 双端时钟的最终架构。
- ✅ **战斗基础闭环**: 跑通了 军团出生 -> 阵型排列 -> 渲染 -> 状态机驱动 的完整流程。
- ✅ **技术壁垒构建**: 输出了 5+ 篇高质量架构文档，明确了自研 NPData 对抗 Unity 原生方案的战略优势。

### 下周计划

- 完善行为树编辑器调试功能 (Runtime Debugger)
- 实现士兵战斗的具体表现 (Attack/Hit)
- 引入 LLM 辅助配置流程原型

## 本周进展

### 2026-01-07（周三）

- ✅ **深度技术归档**：完成《C# 集合底层原理》与《自研 NPData 战略价值》两篇核心文档，夯实架构理论基础。
- ✅ **战略价值分析**：深度剖析 Unity 6 Behavior 的数据封闭性（专有二进制流），明确自研系统的 "数据开放性" 与 "LLM 适配性" 为战略壁垒。
- ✅ **代码重构**：解耦了 `SquadStackFsm` 的状态 ID 与优先级逻辑，修复了设计缺陷。
- ✅ **文档管线优化**：修复了文档生成的 Markdown 排版问题。
- 📅 **明日计划**:
  1. **Resume Coding**: 回归代码开发，推进战斗逻辑。
  2. **Stack FSM Testing**: 验证重构后的状态机优先级逻辑。

### 2026-01-04（周日）

- ✅ **Deep Clone 性能优化**：废弃 BSON 序列化深拷贝，实现 `NPDataCloneUtility` + `Clone()` 手写克隆，解决锁竞争并大幅降低 GC。
- ✅ **黑板数据修复**：查明并修复 `ANP_BBValue` 缺失 `[Serializable]` 导致的数据丢失问题。
- ✅ **工具链建设**：开发 `ActionNodeGeneratorWindow`，实现 Action/Node 脚本自动化生成。
- ✅ **编辑器优化**：实现 Graph 资产在独立窗口打开，优化多屏工作流。
- 📅 **明日计划**:
  1. **栈动画状态机**: 为 UnitClassType 划分栈动画状态，并实现与行为树的联动。
  2. **基础战斗闭环**: 跑通 Soldie 从出生 -> 待机 -> 发现敌人 -> 追击 的完整流程。

### 2026-01-03（周六）

- ✅ **行为树架构设计**：确定了“同构树 + 根节点分流 + 黑板同步”的最终架构，解决了双端逻辑与表现复用的难题。
- ✅ **Zenject 集成**：解决了 Zenject 6 `AsSingle` + `WithId` 的冲突问题，并实现了 NP 行为树的 DI 工厂模式。
- ✅ **双端时钟驱动**：实现了 `ServerClockDriver` 和 `ClientClockDriver`，将 NP `Clock` 接入 Zenject `FixedTick` 系统。
- ✅ **文档体系建设**：输出了包含架构图、问题背景与解决方案的三篇核心架构文档，并自动同步到技术博客。
- 📅 **明日计划**:
  1. **Attack Loop**: 索敌 (Distance Check) -> 攻击 (Timer/Cooldown)。
  2. **Damage Calculation**: Server 端计算伤害，同步 HP 变化。
  3. **Visual Feedback**: Client 端播放攻击动画与受击特效 (RPC)。

### 2026-01-02（周五）

- ✅ **阵型系统**：实现了基于配置的方阵（Phalanx）排列逻辑，支持 Commander 相对坐标计算。
- ✅ **实体渲染**：实现了 Soldier 模型的加载与 GPU Instancing 渲染准备（目前使用 Prefab 模式）。
- ✅ **编辑器可视化**：添加了 Spawn Point 和 Squad 边界的 Gizmos 绘制，便于调试。

### 2026-01-01（周四）

- ✅ **数值系统架构重构**：实现了基于修改器（Modifier）的属性系统，支持 `Base -> Modifier -> Final` 的自动计算与广播机制。
- ✅ **Squad UI 架构**：设计并实现了 `SquadInfoViewModel` 和 `SquadInfoWidget`，完成了指挥官与方阵 UI 的动态绑定。
- ✅ **数据持久化修复**：修复了 `ShowcaseContext` 在 UI 重载时的数据丢失问题（Register 时序优化）。
- ✅ **技术文档输出**：输出了数值系统架构设计文档，并建立了自动同步到博客的 Git 工作流。
- 📅 **明日计划**:
  1. **Spawn Position**: 添加 Commander 和 Squad 的出生点逻辑与 Editor Gizmos 可视化。
  2. **Formation**: 实现 Squad 阵型逻辑。
  3. **Rendering**: 加载并渲染 Soldier 实体。
  4. **Self-Check**: 检查并修复潜在问题。

### 2025-12-31（周三 - 预备日）

- ✅ **年度计划交接**：完成了 2025 年末的总结归档，制定了 2026 年第一周的开发计划。
- 📅 **明日计划**:
  - **Legion Decision**: 评估军团层级的必要性。
  - **Squad & UI Sync**: 完成 Squad 数据与 UI 的同步。
  - **Soldier Loading**: 实现 Squad 下 Soldier 的实体加载。
