---
title: "2025 年第 51 周 - 双世界架构搭建"
date: 2025-12-18T00:00:00+08:00
tags: ["Unity", "SLG", "架构设计", "Zenject"]
draft: false
summary: "本周周报汇总。"
---

## 本周进展

### 2025-12-21（周日）

#### 网络架构深度重构

- ✅ **网络架构现代化**：彻底废弃继承式网络组件，全面拥抱**组合模式 (Composition)** (`NetworkIdHandle`) 和 **生命周期接口化** (`INetworkBehaviour`)，解决了长期困扰的耦合与泄露问题
- ✅ **Payload 协议升级**：实现了通用的 `RpcSpawnObject` + Payload 传输机制，支持动态传递 `OwnerNetId`，完美适配多人/多阵营场景
- ✅ **生命周期闭环**：建立了 `InitAsync` -> `Tick` -> `ShutdownAsync` 的完整生命周期链路，确保网络对象 "来去无痕"，不仅是运行正确，更是内存安全

#### 小队逻辑与数据管线

- ✅ **Server Squad 构建**：实现了 `ServerTeamRuntime` 对 `ServerSquadRuntime` 的构造与管理，完成了小队层级的双端网络同步
- ✅ **时序自愈**：通过 Pending Queue 机制解决了 Server Spawn 先于 Team 到达 Client 的时序问题
- ✅ **SLG 数据链打通**：接入 BSON 数据流，实现了 Unit/Squad 复杂属性图的加载与反序列化
- ✅ **调试基础设施**：实装了文件日志系统与 Editor 开关，提升了真机调试效率

### 2025-12-19（周五）

#### 军队与网络架构优化

- ✅ **Team & Soldier 架构深化**：重构 `TeamID` 为 `Long` 类型并与 `Player/Faction` 关联，确立了 Server 端单 Team Seed 的初始化流程
- ✅ **NetId 路由系统**：实现基于 `NetId` 的 RPC 路由，确保指令能精准控制 Faction/Team 等具体实体
- ✅ **SLG 数据地基**：引入 Unit 和 Squad 的属性图（Attribute Graphs），为兵种数值和战斗逻辑打下基础

### 2025-12-18（周四）

#### 双世界架构核心搭建

- ✅ **FactionId 枚举化重构**：将 `FactionId` 从 `int` 改为 `FactionType` 枚举，提升代码可读性和类型安全
- ✅ **双世界基础框架**：完成 `ServerManager`/`ClientManager` 的初始化流程，确保 Client 先监听再 Server 广播

#### Faction 层级体系实现

- ✅ **FactionBase 共生架构**：`ServerFaction` 和 `ClientFaction` 共享父类，实现逻辑对称
- ✅ **Server-Driven 模式**：Server 通过 `RpcCreateFaction`/`RpcCreateTeam` 驱动 Client 端视图生成
- ✅ **IRoomManager 接口**：统一 `ServerRoomManager` 和 `ClientRoomManager` 的契约

#### 确定性 Tick 系统

- ✅ **ServerTickManager 接入**：以固定 10Hz 频率驱动逻辑层
- ✅ **Tick 同步**：Client 端通过 `OnTickSync` 接收服务器帧号

#### 文档体系完善

- ✅ **演示目标重构**：明确 Demo 重点为"快速制作大量技能"
- ✅ **实时 SLG 技能框架**：基于 COK/War and Order 等出海产品设计技能系统框架
- ✅ **Daily Review 工作流增强**：新增周报同步到博客功能
