---
title: "Week 51, 2025 - Dual-World Architecture Setup"
date: 2025-12-18T00:00:00+08:00
tags: ["Unity", "SLG", "Architecture", "Zenject"]
draft: false
summary: "Weekly report highlights and progress."
---

## This Week's Progress

### December 22, 2025 (Monday)

#### Architecture Design & Documentation

- ✅ **Hierarchical Command System**: Designed the four-layer nested architecture (`Commander -> Legion -> Phalanx -> Soldier`) and defined a hybrid strategy using Zenject Factory (Higher-level Logic) and MemoryPool (Massive Entities)
- ✅ **Bilingual Documentation**: Published the architecture decision record `Commander_Unit_Hierarchy.md` in both Chinese and English

#### Dual-World RoomManager Fixes

- ✅ **Timing Self-Healing**: Fixed the issue where Commander was created too early in `InitAsync`, causing reference loss
- ✅ **Lifecycle Closure**: Restored the accidentally removed `RpcDestroyObject` handling logic, preventing "ghost units" on the client side
- ✅ **Tick Propagation**: Implemented the `Tick`/`Update` chain from RoomManager to Commander, ensuring the logic frame is correctly driven

### December 21, 2025 (Sunday)

#### Network Architecture Refactor

- ✅ **Modernized Architecture**: Abandoned inheritance-based components in favor of **Composition** (`NetworkIdHandle`) and **Interface-based Lifecycle** (`INetworkBehaviour`), solving coupling and leakage issues
- ✅ **Payload Protocol Upgrade**: Implemented generic `RpcSpawnObject` + Payload mechanism, supporting dynamic `OwnerNetId` transmission, perfectly adapting to multi-player/multi-faction scenarios
- ✅ **Lifecycle Closure**: Established a complete `InitAsync` -> `Tick` -> `ShutdownAsync` lifecycle chain, ensuring network objects are not only logically correct but also memory-safe

#### Squad Logic & Data Pipeline

- ✅ **Server Squad Construction**: Implemented `ServerTeamRuntime` logic to construct and manage `ServerSquadRuntime`, completing dual-end network synchronization at the Squad level
- ✅ **Timing Self-Healing**: Resolved the timing issue where Server Spawn arrives at Client before Team using a Pending Queue mechanism
- ✅ **SLG Data Chain**: Integrated BSON data flow, enabling loading and deserialization of complex Unit/Squad attribute graphs
- ✅ **Debug Infrastructure**: Implemented file logging system and Editor toggle, improving on-device debugging efficiency

### December 19, 2025 (Friday)

#### Army & Network Architecture Optimization

- ✅ **Team & Soldier Architecture**: Refactored `TeamID` to `Long` type and wired it with `Player/Faction`, establishing the Server-side single Team Seed initialization flow
- ✅ **NetId Routing System**: Implemented `NetId`-based RPC routing to ensure accurate command targeting for specific entities (Faction/Team)
- ✅ **SLG Data Foundation**: Introduced Attribute Graphs for Unit and Squad, laying the groundwork for combat stats and logic

### December 18, 2025 (Thursday)

#### Dual-World Architecture Core Implementation

- ✅ **FactionId Enum Refactor**: Converted `FactionId` from `int` to `FactionType` enum for improved code readability and type safety
- ✅ **Dual-World Framework**: Completed `ServerManager`/`ClientManager` initialization flow, ensuring Client listens before Server broadcasts

#### Faction Hierarchy System

- ✅ **FactionBase Shared Architecture**: `ServerFaction` and `ClientFaction` share a common base class for logical symmetry
- ✅ **Server-Driven Pattern**: Server drives Client-side view generation through `RpcCreateFaction`/`RpcCreateTeam`
- ✅ **IRoomManager Interface**: Unified contract between `ServerRoomManager` and `ClientRoomManager`

#### Deterministic Tick System

- ✅ **ServerTickManager Integration**: Drives logic layer at fixed 10Hz frequency
- ✅ **Tick Synchronization**: Client receives server frame numbers via `OnTickSync`

#### Documentation Enhancement

- ✅ **Demonstration Goals Refactor**: Clarified Demo focus on "rapid skill creation at scale"
- ✅ **Real-time SLG Skill Framework**: Designed skill system framework based on COK/War and Order best practices
- ✅ **Daily Review Workflow Enhancement**: Added weekly blog synchronization feature
