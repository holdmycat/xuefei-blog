{{ $p := .Site.Params.home }}

<div class="home-sections-wrap">
  <section class="home-writing">
    <div class="section-header">
      <h2>Latest Writing</h2>
    </div>
    <div class="writing-list">
      {{ $writingSection := site.GetPage "section" "posts" }}
      {{ if not $writingSection }}
        {{ $writingSection = site.GetPage "section" "writing" }}
      {{ end }}

      {{ $posts := slice }}
      {{ if $writingSection }}
        {{ $posts = first 3 ($writingSection.RegularPages.ByDate.Reverse) }}
      {{ else }}
        {{ $posts = first 3 ((where .Site.RegularPages "Section" "posts").ByDate.Reverse) }}
      {{ end }}
      {{ range $posts }}
        <article class="writing-card">
          <div class="meta">
            <span>{{ .Date.Format "Jan 2, 2006" }}</span>
            {{ with .Params.tags }}
              {{ $tags := . }}
              {{ $maxTags := 6 }}
              {{ $total := len $tags }}
              <span class="dot">•</span>
              <div class="tag-list">
                {{ range first $maxTags $tags }}<span class="tag">#{{ . }}</span>{{ end }}
                {{ if gt $total $maxTags }}
                  <span class="tag tag-more">+{{ sub $total $maxTags }}</span>
                {{ end }}
              </div>
            {{ end }}
          </div>
          <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
        </article>
      {{ else }}
        <p class="muted">No writing yet.</p>
      {{ end }}
    </div>
    <div class="writing-footer">
      {{ if $writingSection }}
        <a class="small-link" href="{{ $writingSection.RelPermalink }}">View all writing →</a>
      {{ end }}
    </div>
  </section>
</div>
