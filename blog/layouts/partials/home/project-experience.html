{{ $projects := .Site.Data.projects.projects }}
{{ if $projects }}
  <section class="project-experience">
    <div class="pinned-container">
      <div class="projects-header">
        <h2 class="projects-title">项目经历</h2>
      </div>
      <div class="projects-list">
        {{ range first 2 $projects }}
          {{ $project := . }}
          {{ $cover := strings.TrimPrefix "/" $project.cover | relURL }}
          {{ $videoCover := "" }}
          {{ if and $project.video $project.video.cover }}
            {{ $videoCover = strings.TrimPrefix "/" $project.video.cover | relURL }}
          {{ end }}
          {{ $gallery := slice }}
          {{ range $project.gallery }}
            {{ $gallery = $gallery | append (strings.TrimPrefix "/" . | relURL) }}
          {{ end }}
          {{ $video := dict }}
          {{ if $project.video }}
            {{ $video = dict "provider" $project.video.provider "bvid" $project.video.bvid "cover" $videoCover "iframe_src" $project.video.iframe_src "title" $project.video.title "autoplay" $project.video.autoplay }}
          {{ end }}
          {{ $links := dict "github" $project.links.github "demo" $project.links.demo "steam" $project.links.steam "bilibili" $project.links.bilibili }}
          {{ $modal := dict "id" $project.id "title" $project.title "subtitle" $project.subtitle "period" $project.period "description" $project.description "responsibility" $project.responsibility "team_size" $project.team_size "cover" $cover "tags" $project.tags "tech_stack" $project.tech_stack "video" $video "gallery" $gallery "links" $links }}
          <article class="project-row" data-project-id="{{ $project.id }}" data-project='{{ $modal | jsonify | safeHTMLAttr }}'>
            <div class="project-thumb" data-project-main>
              {{ with $cover }}
                <img src="{{ . }}" alt="{{ $project.title }} cover" loading="lazy" decoding="async">
              {{ end }}
            </div>
            <div class="project-main">
              <div class="project-heading">
                <h3 class="project-title">{{ $project.title }}</h3>
                {{ with $project.subtitle }}<p class="project-subtitle">{{ . }}</p>{{ end }}
              </div>
              {{ with $project.tags }}
                <div class="project-tags">
                  {{ range . }}<span class="tag">{{ . }}</span>{{ end }}
                </div>
              {{ end }}
              {{ with $project.description }}
                <p class="project-desc">{{ . }}</p>
              {{ end }}
              <div class="project-links">
                {{ with $project.video }}
                  <button class="btn primary" type="button" data-project-play data-project-iframe="{{ .iframe_src }}" data-project-bvid="{{ .bvid }}" data-project-video-cover="{{ $videoCover }}">观看视频</button>
                {{ end }}
                <button class="btn" type="button" data-project-detail>查看详情</button>
              </div>
            </div>
            <aside class="project-meta">
              {{ with $project.period }}
                <div class="meta-row">
                  <div class="meta-k">开发日期</div>
                  <div class="meta-v">{{ . }}</div>
                </div>
              {{ end }}
              {{ with $project.tech_stack }}
                <div class="meta-row">
                  <div class="meta-k">技术栈</div>
                  <div class="meta-v">
                    <div class="tech-list">
                      {{ range . }}<span class="chip">{{ . }}</span>{{ end }}
                    </div>
                  </div>
                </div>
              {{ end }}
            </aside>
          </article>
        {{ end }}
      </div>
    </div>
  </section>
{{ end }}
